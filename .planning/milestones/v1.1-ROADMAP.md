# Milestone v1.1: Plan & Execute Commands

**Status:** ✅ SHIPPED 2026-01-23
**Phases:** 7-13
**Total Plans:** 21

## Overview

Enable autonomous AI-driven development via GitHub issue comments. Users can plan and execute individual phases through @gsd-bot commands, with comprehensive test coverage and automatic issue tracking.

## Phases

### Phase 7: Phase Planning Command

**Goal**: Implement `gsd:plan-phase` command that parses phase numbers and creates detailed execution plans.
**Depends on**: Phase 6 (Authorization)
**Plans**: 1 plan

**Status:** Complete (2026-01-22)

Plans:

- [x] 07-01: Phase planning command (phase-planner.js module, command allowlist, command dispatch)

**Details:**

Created `src/milestone/phase-planner.js` with:
- parsePhaseNumber - supports --phase N, -p N, and standalone number formats
- executePhaseWorkflow - executes GSD via CCR stdin pipe with 10-min timeout
- Output validation for errors
- Structured output posting to GitHub

Files created:
- `src/milestone/phase-planner.js` (8 exports)
- `src/milestone/phase-planner.test.js` (7 tests)

---

### Phase 8: Phase Execution Command

**Goal**: Implement `gsd:execute-phase` command that executes planned actions with resume capability.
**Depends on**: Phase 7
**Plans**: 1 plan

**Status:** Complete (2026-01-22)

Plans:

- [x] 08-01: Execute-phase command (phase-executor.js module, enhanced output parsing, 30-min timeout)

**Details:**

Created `src/milestone/phase-executor.js` with:
- parsePhaseNumber - same format as phase-planner
- executePhaseWorkflow - executes GSD with 30-min timeout (vs 10-min for planning)
- Enhanced output parsing with regex for completed actions, next steps, questions
- Returns hasQuestions flag for conversational continuation

Features:
- 30-minute timeout for execution-heavy workflows
- Structured output parsing (not raw pass-through)
- Collapsible raw output section in comments
- Resume capability (GSD internal state tracking)

---

### Phase 8.1: GitHub Projects & Issue Tracking and Organization (INSERTED)

**Goal**: Infrastructure for organizing milestone work — labels as source of truth, GitHub Projects for visual grouping, minimal API work.
**Depends on**: Phase 8
**Plans**: 3 plans

**Status:** Complete (2026-01-22)

Plans:

- [x] 08.1-01: Label helpers (labels.js module with STATUS_LABELS, ensureLabelsExist, applyLabels, updateIssueStatus)
- [x] 08.1-02: Project GraphQL queries (projects.js module, milestone iteration validation)
- [x] 08.1-03: User documentation (project-setup.md guide for manual iteration setup)

**Details:**

Labels module (`src/lib/labels.js`):
- STATUS_LABELS: 4 labels (pending, in-progress, complete, blocked) with semantic colors
- ensureLabelsExist: creates labels with 422 error handling (race conditions)
- applyLabels: adds labels to issues
- updateIssueStatus: atomic status label replacement

Projects module (`src/lib/projects.js`):
- getProject: fetches project by number (org or user)
- getIterations: fetches all iterations for a project
- findIteration: finds iteration by title (case-insensitive)
- Read-only GraphQL queries (no iteration creation - causes data loss)

Documentation (`docs/project-setup.md`):
- 313-line comprehensive setup guide
- Manual iteration creation instructions
- Label automations configuration
- Step-by-step board setup

---

### Phase 9: Issue Tracking Integration

**Goal**: Create GitHub issues for each action and enable bidirectional status sync.
**Depends on**: Phase 8.1
**Plans**: 3 plans

**Status:** Complete (2026-01-23)

Plans:

- [x] 09-01: Issues module (src/lib/issues.js with task parsing and issue CRUD)
- [x] 09-02: Phase planner integration (create issues after planning)
- [x] 09-03: Phase executor integration (update status during execution)

**Details:**

Issues module (`src/lib/issues.js`):
- extractTasksFromPlan: XML-style regex parsing of <task type="...">...</task> blocks
- formatIssueBody: markdown formatter with action details, verification, done criteria
- createIssuesForTasks: sequential issue creation with phase-N labels
- getPhaseIssues: query issues by phase label
- Title truncation at 240 chars, body at 65000 chars

Integration points:
- Phase planner: calls createIssuesForTasks after GSD planning completes
- Phase executor: calls updateIssueStatus (from labels.js) and getPhaseIssues during execution

---

### Phase 10: Test for Each Service, Method, Feature and Flow

**Goal**: Comprehensive test coverage for all source modules using Vitest, with mocked GitHub API, child_process, and @actions packages.
**Depends on**: Phase 9
**Plans**: 7 plans

**Status:** Complete (2026-01-23)

**Wave Structure:**
- Wave 1: 10-01 (infrastructure setup - must complete first)
- Wave 2: 10-02, 10-03, 10-04 (parallel - no dependencies)
- Wave 3: 10-05, 10-06 (depend on Wave 2)
- Wave 4: 10-07 (finalization after all tests exist)

Plans:

- [x] 10-01: Test infrastructure (vitest.config.js, test/setup.js, fetch mocking)
- [x] 10-02: Pure logic unit tests (parser, validator, formatter, slugify, prompts, auth/errors)
- [x] 10-03: GitHub API tests (auth/validator, labels, projects, github)
- [x] 10-04: Child process tests (git, branches, phase-planner, phase-executor)
- [x] 10-05: Orchestrator tests (milestone/index, requirements, planning-docs, handler, config)
- [x] 10-06: Entry point tests (index.js command dispatch integration)
- [x] 10-07: CI integration (finalize suite, add test workflow)

**Details:**

Test infrastructure:
- Vitest with v8 coverage
- 80% coverage thresholds (all metrics)
- Global @actions mocking in test/setup.js
- Colocated test pattern: src/*/*.test.js

Coverage results (469 tests, 94.15% overall):
- auth/, errors/, git/, lib/llm/: 100%
- milestone/: 93.19%
- src/index.js: 84.21%

CI/CD:
- `.github/workflows/test.yml` - automated testing on push and PR
- test:ci script for CI-optimized execution
- Codecov integration (graceful degradation)
- Node.js 20 runtime (matches action.yml)

---

### Phase 11: Output Parsing Improvements

**Goal**: Fix output formatting issues in GitHub comments — duplicate errors, CCR log pollution, false positive task matching.
**Depends on**: Phase 10
**Plans**: 1 plan

**Status:** Complete (2026-01-23)

Plans:

- [x] 11-01: Output parsing fixes (duplicate errors, CCR stripping, GSD block extraction)

**Details:**

Fixed issues:
- Duplicate error posting: Delegated to withErrorHandling wrapper (single source)
- CCR log pollution: Strip [log_xxx], response 200 http://, JS object notation via regex
- GSD block extraction: Extract from LAST "GSD ►" marker (handles multiple markers)
- Fallback: Last 80 lines if no GSD marker found
- Task matching: Only explicit [x] checkbox markers (not "Complete" text)

---

### Phase 12: CCR Command Formatting

**Goal**: Extract CCR command formatting into centralized helper for consistent command structure across all workflow modules.
**Depends on**: Phase 11
**Plans**: 1 plan

**Status:** Complete (2026-01-23)

Plans:

- [x] 12-01: CCR command helper (formatCcrCommand, formatCcrCommandWithOutput)

**Details:**

Created `src/llm/ccr-command.js` with:
- formatCcrCommand(command, prompt?, skill?): Base command formatter
- formatCcrCommandWithOutput(command, outputPath, text?, skill?): Output-capturing formatter
- Pattern: `/github-actions-testing and now trigger command /gsd:{command}`
- SKILL_COMMAND_MAP validation for valid skills
- Prompt and skill parameters threaded through for future use

Modules updated:
- phase-planner.js: Use helper instead of inline command
- phase-executor.js: Use helper instead of inline command
- milestone-completer.js: Use helper instead of inline command

---

### Phase 13: Milestone Trigger via "good first issue" Label

**Goal**: Trigger new-milestone workflow automatically when a GitHub issue receives the "good first issue" label. GSD determines milestone number, creates planning artifacts. We parse outputs and update the triggering issue.
**Depends on**: Phase 12
**Plans**: 4 plans

**Status:** Complete (2026-01-23)

**Wave Structure:**
- Wave 1: 13-01, 13-02 (parallel - trigger workflow and milestone refactor)
- Wave 2: 13-03, 13-04 (sequential - 13-03 creates parsers, 13-04 uses them)

Plans:

- [x] 13-01: Workflow trigger and orchestrator (gsd-label-trigger.yml, label-trigger.js, action.yml updates)
- [x] 13-02: Optional milestone number (refactor executeMilestoneWorkflow for GSD-determined numbers)
- [x] 13-03: Planning artifact parsers (planning-parser.js for REQUIREMENTS.md and ROADMAP.md)
- [x] 13-04: Issue update integration (parse metadata after GSD, update triggering issue)

**Details:**

Label trigger workflow:
- `.github/workflows/gsd-label-trigger.yml` - triggers on `issues.labeled` event
- label-trigger.js - orchestrates GSD execution with issue title + body as prompt
- trigger-type input: discriminates comment vs label triggers
- Bypasses authorization check (label permissions already gate who can add labels)

Planning parser (`src/lib/planning-parser.js`):
- parseRequirements: Extracts milestone title, version, core value from REQUIREMENTS.md
- parseRoadmap: Extracts phase numbers, names, and statuses from ROADMAP.md
- parseMilestoneMetadata: Combines both parsers with Promise.all
- Regex-based parsing (sufficient for GSD's consistent format)
- Graceful ENOENT handling

Issue update integration:
- updateIssueBody in github.js - wrapper around octokit.rest.issues.update
- Issue body appended (not replaced) to preserve original content
- Structured milestone section with checkboxes for phase tracking
- Graceful failure handling: metadata parse/update failures don't fail workflow
- Success comment posted separately with actionable next steps

---

## Milestone Summary

**Decimal Phases:**
- Phase 8.1: GitHub Projects & Issue Tracking and Organization (INSERTED) — Infrastructure for labels and projects before Phase 9

**Key Decisions:**

From Phase 7:
- Phase planner follows same pattern as milestone workflow (parseXxxNumber, executeXxxWorkflow)
- 10-minute timeout for planning (vs 30-min for execution)

From Phase 8:
- Structured output parsing vs raw pass-through for better visibility
- 30-minute timeout for execution-heavy workflows
- hasQuestions flag enables conversational continuation

From Phase 8.1:
- Status labels use status: prefix for namespacing
- Labels as source of truth (projects = visualization only)
- Projects v2 queries are read-only (API causes data loss if used for creation)
- Manual iteration setup documented

From Phase 9:
- Regex parsing instead of XML parser (sufficient for GSD format)
- Sequential issue creation with per-issue error handling
- Title/body truncation to prevent API errors

From Phase 10:
- Vitest chosen for ESM-native support and Node.js 24 compatibility
- Colocated test pattern (src/*/*.test.js)
- Global @actions mocking required due to module-time execution
- 80% coverage thresholds

From Phase 11:
- Error posting delegated to withErrorHandling (single source of truth)
- GSD block extracted from LAST marker (handles multiple markers)
- Only [x] checkboxes matched for completed tasks

From Phase 12:
- Centralized CCR command helper for consistency
- Skill parameter threaded early for future feature

From Phase 13:
- Label triggers bypass authorization check (permissions already gated)
- Issue body appended (not replaced) to preserve content
- Graceful failure for supplementary operations

**Issues Resolved:**
- Fixed duplicate error posting in GitHub comments
- Eliminated CCR log pollution from outputs
- Resolved false positive task matching from markdown text
- Centralized CCR command format for maintainability
- Added automated testing with 94.15% coverage
- Enabled label-triggered milestone creation with issue updates

**Issues Deferred:**
None - all v1.1 requirements complete.

**Technical Debt Incurred:**
None - all code integrated and tested.

---

_For current project status, see .planning/ROADMAP.md (will be deleted after milestone completion)_

---

_Archived: 2026-01-23 as part of v1.1 milestone completion_
