---
phase: "07-phase-planning-command"
plan: "02"
type: "execute"
wave: 2
depends_on: ["07-01"]
files_modified:
  - ".planning/phases/07-phase-planning-command/07-RESEARCH.md"
  - ".planning/phases/07-phase-planning-command/07-01-PLAN.md"
  - ".planning/phases/07-phase-planning-command/07-02-PLAN.md"
autonomous: true
must_haves:
  truths:
    - "Phase 7 planning documents exist and are properly formatted"
    - "Plans can be committed to phase branch"
    - "Summary comment can be generated for phase planning completion"
  artifacts:
    - path: ".planning/phases/07-phase-planning-command/07-01-SUMMARY.md"
      provides: "Execution summary for Wave 1"
    - path: ".planning/phases/07-phase-planning-command/07-RESEARCH.md"
      provides: "Research findings integrated into plan structure"
  key_links:
    - from: "src/milestone/phase-planner.js"
      to: ".planning/phases/07-phase-planning-command/"
      via: "generatePhasePlanMarkdown creates files in this directory"
    - from: "src/index.js"
      to: ".planning/phases/07-phase-planning-command/"
      via: "Command dispatch triggers plan generation"
---

<objective>
Generate PLAN.md files for Phase 7 itself and create the summary documents.

This Wave 2 completes Phase 7 by:
- Creating the summary for Wave 1 execution (07-01-SUMMARY.md)
- Adding the must_haves and wave structure to 07-RESEARCH.md
- Ensuring Phase 7 can self-reference its own plans

This demonstrates the phase planning workflow end-to-end by having Phase 7 plan itself.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-phase-planning-command/07-RESEARCH.md
@.planning/phases/07-phase-planning-command/07-01-PLAN.md
@src/milestone/phase-planner.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create 07-01-SUMMARY.md for Wave 1</name>
  <files>.planning/phases/07-phase-planning-command/07-01-SUMMARY.md</files>
  <action>
    Create the execution summary document at `.planning/phases/07-phase-planning-command/07-01-SUMMARY.md`.

    The summary should follow the format from summarizer.js patterns and include:

    ## Wave 1 Execution Summary

    **Phase:** 07-phase-planning-command
    **Plan:** 07-01
    **Wave:** 1
    **Status:** Complete

    ### Tasks Executed

    | Task | Status | Notes |
    |------|--------|-------|
    | Update command allowlist in validator.js | Done | Added "plan-phase" to ALLOWED_COMMANDS |
    | Create phase-planner.js module | Done | 8 exports: parsePhaseNumber, executePhaseWorkflow, etc. |
    | Extend command dispatch in index.js | Done | Added plan-phase handler |

    ### Files Created/Modified

    | File | Change |
    |------|--------|
    | src/lib/validator.js | Added "plan-phase" to ALLOWLIST |
    | src/milestone/phase-planner.js | Created with all required functions |
    | src/index.js | Added import and dispatch for plan-phase |

    ### Key Artifacts Available

    - `parsePhaseNumber(commandArgs)` - Extracts phase number from --phase N, -p N, or standalone
    - `executePhaseWorkflow(context, commandArgs)` - Main orchestrator for phase planning
    - `generatePhasePlanMarkdown(phaseData, wave)` - Generates PLAN.md content
    - `generatePhasePlanningSummary(data)` - Generates completion summary
    - `groupTasksIntoWaves(tasks)` - Groups tasks by dependency level

    ### Next Steps

    1. Proceed to Wave 2 for self-referential plan generation
    2. Test command dispatch with `@gsd-bot plan-phase 7`
    3. Verify PLAN.md files are created in `.planning/phases/07/`
  </action>
  <verify>test -f .planning/phases/07-phase-planning-command/07-01-SUMMARY.md && grep -q "Wave 1 Execution Summary" .planning/phases/07-phase-planning-command/07-01-SUMMARY.md</verify>
  <done>Wave 1 summary exists and documents completed tasks</done>
</task>

<task type="auto">
  <name>Task 2: Add must_haves section to 07-RESEARCH.md</name>
  <files>.planning/phases/07-phase-planning-command/07-RESEARCH.md</files>
  <action>
    Append a must_haves section to 07-RESEARCH.md that defines the Phase 7 success criteria.

    Add at the end of the file (before the Sources section):

    ## Must-Haves for Phase 7

    ### Observable Truths

    - Command 'plan-phase' is recognized and validated
    - Phase number is parsed from command arguments
    - Phase planner creates detailed execution plans with tasks, dependencies, and verification
    - Plans are committed to `.planning/phases/{n}/` directory
    - Bot posts summary comment when phase planning completes

    ### Required Artifacts

    - `src/lib/validator.js` - ALLOWLIST includes "plan-phase"
    - `src/index.js` - Command dispatch handles plan-phase workflow
    - `src/milestone/phase-planner.js` - parsePhaseNumber, executePhaseWorkflow, generatePhasePlanMarkdown, generatePhasePlanningSummary, groupTasksIntoWaves, createPhaseState, loadPhaseState, savePhaseState
    - `.planning/phases/{n}/07-XX-PLAN.md` - Wave plan files

    ### Key Wiring

    - validator.js -> phase-planner.js (command validation passes to workflow)
    - index.js -> phase-planner.js (executePhaseWorkflow call)
    - phase-planner.js -> .planning/phases/{n}/ (generatePhasePlanMarkdown creates files)

    ### Wave Structure

    - Wave 1: Foundation (command allowlist, phase-planner.js module, command dispatch)
    - Wave 2: Plan generation (self-referential PLAN.md files, summary documents)
  </action>
  <verify>grep -q "Must-Haves for Phase 7" .planning/phases/07-phase-planning-command/07-RESEARCH.md</verify>
  <done>07-RESEARCH.md includes must_haves section</done>
</task>

<task type="auto">
  <name>Task 3: Create phase directory and test PLAN.md template</name>
  <files>.planning/phases/07-phase-planning-command/07-PLANS.md</files>
  <action>
    Create a test PLAN.md file to verify the generatePhasePlanMarkdown function will produce correct output.

    Create `.planning/phases/07-phase-planning-command/07-PLANS.md` as a reference document showing the planned structure for Phase 7 execution:

    ```
    # Phase 7: Phase Planning Command

    **Milestone:** v1.1
    **Phase:** 7
    **Goal:** Implement `gsd:plan-phase` command that parses phase numbers and creates detailed execution plans

    ## Requirements

    | ID | Description | Status |
    |----|-------------|--------|
    | PLAN-01 | `gsd:plan-phase` command parses phase number | Pending |
    | PLAN-02 | Phase planner creates detailed execution plans | Pending |
    | PLAN-03 | Plans committed to `.planning/phases/{n}/` | Pending |

    ## Wave 1: Foundation

    | Task ID | Description | Depends On | Verification |
    |---------|-------------|------------|--------------|
    | 07-01-01 | Update command allowlist | None | ALLOWLIST includes "plan-phase" |
    | 07-01-02 | Create phase-planner.js | 07-01-01 | Module exports all functions |
    | 07-01-03 | Extend command dispatch | 07-01-02 | Command handled correctly |

    ## Wave 2: Plan Generation

    | Task ID | Description | Depends On | Verification |
    |---------|-------------|------------|--------------|
    | 07-02-01 | Create 07-01-SUMMARY.md | 07-01 | Summary exists |
    | 07-02-02 | Add must_haves to RESEARCH | 07-01 | Section exists |
    | 07-02-03 | Create 07-PLANS.md template | 07-02-01 | Template verified |

    ## Execution Order

    Wave 1 tasks can execute in parallel (no dependencies between 07-01-01, 07-01-02, 07-01-03).
    Wave 2 tasks depend on Wave 1 completion.
    ```
  </action>
  <verify>test -f .planning/phases/07-phase-planning-command/07-PLANS.md && grep -q "Phase 7: Phase Planning Command" .planning/phases/07-phase-planning-command/07-PLANS.md</verify>
  <done>Reference plan document exists for Phase 7</done>
</task>

</tasks>

<verification>
1. 07-01-SUMMARY.md exists and documents Wave 1 execution
2. 07-RESEARCH.md includes must_haves section
3. 07-PLANS.md exists with Phase 7 structure
4. All files are in the correct directory
</verification>

<success_criteria>
- [ ] 07-01-SUMMARY.md documents Wave 1 completion
- [ ] 07-RESEARCH.md has must_haves section
- [ ] 07-PLANS.md provides reference structure
- [ ] Phase 7 has complete documentation for self-referential planning
</success_criteria>

<output>
After completion, create `.planning/phases/07-phase-planning-command/07-02-SUMMARY.md`
</output>
