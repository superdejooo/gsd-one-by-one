---
phase: 02-command-parsing-config
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - src/index.js
autonomous: true

must_haves:
  truths:
    - "Action calls parseComment with comment-body input"
    - "Action logs extracted command and arguments"
    - "Action skips processing when parseComment returns null"
    - "Action sets 'command-found' output to indicate whether bot was mentioned"
  artifacts:
    - path: "src/index.js"
      provides: "Main entry point with parser integration"
      min_lines: 30
  key_links:
    - from: "src/index.js"
      to: "src/lib/parser.js"
      via: "import parseComment, parseArguments"
      pattern: "import.*from.*parser"
    - from: "src/index.js"
      to: "parseComment()"
      via: "function call"
      pattern: "parseComment\\(commentBody\\)"
---

<objective>
Integrate parser into main action entry point to extract and process commands from comments.

Purpose: Wire the parser functions into the main action flow so commands are extracted from incoming comments and processed appropriately.

Output: Updated src/index.js with parser integration
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-command-parsing-config/02-RESEARCH.md
@.planning/STATE.md

# Existing codebase

@src/index.js
@src/lib/parser.js (created in 02-01)
@action.yml
</context>

<tasks>

<task type="auto">
  <name>Integrate parser into main action entry point</name>
  <files>src/index.js</files>
  <action>
Update src/index.js to integrate the parser:

1. Add imports at top:

```javascript
import { parseComment, parseArguments } from "./lib/parser.js";
```

2. After reading inputs, add parsing logic:

```javascript
// Parse comment to extract command
const parsed = parseComment(commentBody);

if (!parsed) {
  core.info("No @gsd-bot command found in comment");
  core.setOutput("command-found", "false");
  core.setOutput("response-posted", "false");
  // Clean exit - no further processing needed
} else {
  core.info(`Found command: ${parsed.command}`);
  core.info(`Arguments: ${parsed.args || "(none)"}`);

  // Parse arguments if present
  const args = parsed.args ? parseArguments(parsed.args) : {};
  core.info(`Parsed arguments: ${JSON.stringify(args)}`);

  // Set outputs
  core.setOutput("command-found", "true");
  core.setOutput("response-posted", "true");
  core.setOutput("command", parsed.command);

  // TODO: Validate command and load config in Phase 2 (plans 02-03)
  // TODO: Execute command logic in later phases
}
```

3. Remove or update existing TODO comment about parsing:

```javascript
// Command parsing handled by parseComment function
```

Why this structure:

- Early exit when bot not mentioned (no wasted processing)
- Clear logging for debugging and monitoring
- Outputs set for use in later phases
- Separates parsing (this plan) from validation (next plan)
  </action>
  <verify>
  cat src/index.js | grep -q "import.*parseComment.*from.\*parser" && cat src/index.js | grep -q "const parsed = parseComment" && cat src/index.js | grep -q "command-found"
  </verify>
  <done>
  src/index.js updated to:
- Import parseComment and parseArguments from parser.js
- Call parseComment with commentBody input
- Log extracted command and arguments
- Skip processing when parseComment returns null
- Set command-found output to indicate bot mention status
  </done>
  </task>

</tasks>

<verification>
After plan completion:
1. Check src/index.js imports parser functions
2. Verify parsing is called with commentBody
3. Verify command-found output is set
4. Test with simulated inputs:
   - commentBody "@gsd-bot new-milestone" sets command-found to true
   - commentBody "hello world" sets command-found to false
5. Verify logging shows command and args when found
</verification>

<success_criteria>

- src/index.js imports parser functions
- parseComment called with commentBody input
- Action logs extracted command and arguments
- Action sets command-found output correctly
- Action cleanly exits when bot not mentioned
- Parsing results available for validation in next plan
  </success_criteria>

<output>
After completion, create `.planning/phases/02-command-parsing-config/02-02-SUMMARY.md`
</output>
