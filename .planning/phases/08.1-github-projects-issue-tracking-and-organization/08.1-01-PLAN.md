---
phase: 08.1-github-projects-issue-tracking-and-organization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/labels.js
autonomous: true

must_haves:
  truths:
    - "Status labels can be created in a repository if missing"
    - "Labels can be applied to issues"
    - "Issue status can be updated by replacing status labels"
  artifacts:
    - path: "src/lib/labels.js"
      provides: "Label CRUD operations for status tracking"
      exports: ["STATUS_LABELS", "ensureLabelsExist", "applyLabels", "updateIssueStatus"]
  key_links:
    - from: "src/lib/labels.js"
      to: "src/lib/github.js"
      via: "imports octokit"
      pattern: "import.*octokit.*from.*github"
---

<objective>
Create label helper module for status tracking via GitHub REST API.

Purpose: Labels are the source of truth for issue status. This module provides functions to create status labels and manage them on issues. GitHub Project board automations will react to label changes automatically.

Output: `src/lib/labels.js` with STATUS_LABELS constant and helper functions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08.1-github-projects-issue-tracking-and-organization/08.1-RESEARCH.md

# Existing codebase patterns
@src/lib/github.js
@src/lib/config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create labels.js module</name>
  <files>src/lib/labels.js</files>
  <action>
Create `src/lib/labels.js` with:

1. **STATUS_LABELS constant** - Export the label taxonomy:
```javascript
export const STATUS_LABELS = [
  { name: 'status:pending', color: 'd4c5f9', description: 'Task is queued, not yet started' },
  { name: 'status:in-progress', color: 'fbca04', description: 'Task is actively being worked on' },
  { name: 'status:complete', color: '0e8a16', description: 'Task is finished' },
  { name: 'status:blocked', color: 'd93f0b', description: 'Task cannot proceed' }
];
```

2. **ensureLabelsExist(owner, repo, labels)** - Create labels if they don't exist:
   - Fetch existing labels via `octokit.rest.issues.listLabelsForRepo`
   - For each label in input, check if it exists (by name)
   - Create missing labels via `octokit.rest.issues.createLabel`
   - Handle 422 error (already exists) gracefully
   - Log created vs skipped labels via `core.info`

3. **applyLabels(owner, repo, issueNumber, labels)** - Add labels to an issue:
   - Use `octokit.rest.issues.addLabels` with labels array
   - Log which labels were applied

4. **updateIssueStatus(owner, repo, issueNumber, newStatus)** - Replace status label:
   - Fetch current labels via `octokit.rest.issues.listLabelsOnIssue`
   - Filter out all existing `status:*` labels
   - Use `octokit.rest.issues.setLabels` to replace with non-status labels + new status
   - Validate newStatus is one of: 'pending', 'in-progress', 'complete', 'blocked'
   - Throw error if invalid status provided

Import `octokit` from `./github.js` and `core` from `@actions/core` following existing patterns.

Use JSDoc comments for all exported functions matching the style in `github.js`.
  </action>
  <verify>
- File exists: `ls src/lib/labels.js`
- No syntax errors: `node --check src/lib/labels.js`
- Exports correct: `node -e "import('./src/lib/labels.js').then(m => console.log(Object.keys(m)))"`
  </verify>
  <done>
- STATUS_LABELS array exported with 4 status labels
- ensureLabelsExist function creates missing labels
- applyLabels function adds labels to issues
- updateIssueStatus function replaces status labels atomically
- All functions use existing octokit instance from github.js
  </done>
</task>

<task type="auto">
  <name>Task 2: Build and verify bundle</name>
  <files>dist/index.js</files>
  <action>
Run the build to verify the new module integrates correctly:

1. Run `npm run build` to bundle with @vercel/ncc
2. Verify bundle completes without errors
3. Check bundle size is reasonable (should increase minimally)

If build fails:
- Check for import path issues
- Verify ESM syntax is correct
- Fix any circular dependencies
  </action>
  <verify>
- Build succeeds: `npm run build` exits 0
- Bundle exists: `ls dist/index.js`
- No duplicate octokit instances (labels.js uses shared instance)
  </verify>
  <done>
- Build passes with new labels.js module
- Bundle size increase is minimal (labels.js is small)
- Module ready for use by other components
  </done>
</task>

</tasks>

<verification>
1. `src/lib/labels.js` exists with all 4 exports
2. `npm run build` succeeds
3. Module follows existing codebase patterns (imports, JSDoc, logging)
</verification>

<success_criteria>
- Labels module created with STATUS_LABELS, ensureLabelsExist, applyLabels, updateIssueStatus
- All functions properly documented with JSDoc
- Build passes without errors
- Module uses shared octokit instance (no duplicate auth)
</success_criteria>

<output>
After completion, create `.planning/phases/08.1-github-projects-issue-tracking-and-organization/08.1-01-SUMMARY.md`
</output>
