# Phase 8.1: GitHub Projects & Issue Tracking and Organization - Research

**Researched:** 2026-01-22
**Domain:** GitHub Projects v2 GraphQL API & GitHub REST API (Labels)
**Confidence:** HIGH (REST API Labels), MEDIUM (Projects v2 GraphQL - iteration creation limitation)

## Summary

GitHub Projects v2 integration involves two distinct APIs: REST API for labels (source of truth for status) and GraphQL API for project/iteration management (visual organization). The architecture is deliberately minimal: labels control state via REST API, GitHub's built-in automations react to label changes to move project cards automatically, and iteration creation has a critical API limitation that requires manual setup.

**Key technical findings:**

- Labels use standard REST API via `octokit.rest.issues.*` (straightforward, well-documented)
- Projects v2 requires GraphQL via `octokit.graphql()` (already available in @actions/github v7)
- **CRITICAL LIMITATION:** No GraphQL mutation exists to add individual iterations; `updateProjectV2Field` replaces ALL iterations, causing existing issues to lose assignments
- Built-in automations handle card movement (status labels trigger column changes) - no custom automation needed
- GITHUB_TOKEN requires explicit `project: write` permission (not granted by default)

**Primary recommendation:** Use REST API for all label operations, use GraphQL for project queries only (get project ID, list iterations), document manual iteration setup process for users, avoid programmatic iteration creation due to API limitation.

## Standard Stack

The GitHub Action already has the necessary libraries installed.

### Core

| Library                    | Version | Purpose                            | Why Standard                                      |
| -------------------------- | ------- | ---------------------------------- | ------------------------------------------------- |
| @actions/github            | ^7.0.0  | GitHub API client (REST + GraphQL) | Official GitHub Actions toolkit, includes Octokit |
| @actions/core              | ^2.0.2  | GitHub Actions logging/inputs      | Official toolkit for Actions development          |
| @octokit/plugin-throttling | ^11.0.3 | Rate limit handling                | Already configured in codebase                    |

### Already Available

The existing codebase (`src/lib/github.js`) already provides:

- Authenticated Octokit instance with throttling
- `octokit.rest.*` for REST API calls
- `octokit.graphql()` for GraphQL queries/mutations
- Automatic GITHUB_TOKEN authentication

**No additional dependencies required.**

### API Surface Areas

**Labels (REST API):**

```javascript
// Already available via existing octokit instance
octokit.rest.issues.createLabel({ owner, repo, name, color, description });
octokit.rest.issues.addLabels({ owner, repo, issue_number, labels: [] });
octokit.rest.issues.listLabelsForRepo({ owner, repo });
octokit.rest.issues.updateLabel({
  owner,
  repo,
  name,
  new_name,
  color,
  description,
});
```

**Projects v2 (GraphQL API):**

```javascript
// Already available via existing octokit instance
await octokit.graphql(`query { ... }`, { variables });
```

## Architecture Patterns

### Recommended Module Structure

```
src/
├── lib/
│   ├── github.js           # Existing: authenticated Octokit instance
│   ├── labels.js           # NEW: label helper functions
│   └── projects.js         # NEW: project GraphQL queries
├── milestone/
│   └── index.js            # UPDATE: integrate iteration creation
└── docs/
    └── project-setup.md    # NEW: user setup guide
```

### Pattern 1: Label Management (REST API)

**What:** Helper functions wrapping REST API calls for label CRUD operations

**When to use:** All label operations (create, apply, update status)

**Example:**

```javascript
// src/lib/labels.js
import { octokit } from "./github.js";

/**
 * Create status labels if they don't exist
 * @param {string} owner - Repository owner
 * @param {string} repo - Repository name
 * @param {Array<{name: string, color: string, description: string}>} labels
 */
export async function ensureLabelsExist(owner, repo, labels) {
  const existingLabels = await octokit.rest.issues.listLabelsForRepo({
    owner,
    repo,
    per_page: 100,
  });

  const existingNames = new Set(existingLabels.data.map((l) => l.name));

  for (const label of labels) {
    if (!existingNames.has(label.name)) {
      await octokit.rest.issues.createLabel({
        owner,
        repo,
        name: label.name,
        color: label.color,
        description: label.description,
      });
    }
  }
}

/**
 * Apply labels to an issue
 * @param {string} owner - Repository owner
 * @param {string} repo - Repository name
 * @param {number} issueNumber - Issue number
 * @param {string[]} labels - Label names to add
 */
export async function applyLabels(owner, repo, issueNumber, labels) {
  await octokit.rest.issues.addLabels({
    owner,
    repo,
    issue_number: issueNumber,
    labels,
  });
}
```

**Source:** [GitHub REST API Labels Documentation](https://docs.github.com/en/rest/issues/labels)

### Pattern 2: Project GraphQL Queries

**What:** GraphQL queries to fetch project information (ID, iterations)

**When to use:** Need project metadata for documentation or validation (NOT for iteration creation)

**Example:**

```javascript
// src/lib/projects.js
import { octokit } from "./github.js";

/**
 * Get organization project by number
 * @param {string} org - Organization login
 * @param {number} projectNumber - Project number from URL
 * @returns {Promise<{id: string, title: string}>}
 */
export async function getOrgProject(org, projectNumber) {
  const query = `
    query($org: String!, $number: Int!) {
      organization(login: $org) {
        projectV2(number: $number) {
          id
          title
        }
      }
    }
  `;

  const result = await octokit.graphql(query, {
    org,
    number: projectNumber,
  });

  return result.organization.projectV2;
}

/**
 * Get iteration field configuration for a project
 * @param {string} projectId - Project node ID
 * @returns {Promise<{id: string, iterations: Array}>}
 */
export async function getIterationField(projectId) {
  const query = `
    query($projectId: ID!) {
      node(id: $projectId) {
        ... on ProjectV2 {
          fields(first: 20) {
            nodes {
              ... on ProjectV2IterationField {
                id
                name
                configuration {
                  iterations {
                    startDate
                    id
                    title
                  }
                }
              }
            }
          }
        }
      }
    }
  `;

  const result = await octokit.graphql(query, { projectId });
  const fields = result.node.fields.nodes;
  return fields.find((f) => f.configuration?.iterations);
}
```

**Source:** [GitHub Projects v2 API Documentation](https://docs.github.com/en/issues/planning-and-tracking-with-projects/automating-your-project/using-the-api-to-manage-projects)

### Pattern 3: Label Taxonomy

**What:** Standard status labels that drive project automation

**Recommended labels:**

```javascript
const STATUS_LABELS = [
  {
    name: "status:pending",
    color: "d4c5f9", // Light purple
    description: "Task is queued, not yet started",
  },
  {
    name: "status:in-progress",
    color: "fbca04", // Yellow
    description: "Task is actively being worked on",
  },
  {
    name: "status:complete",
    color: "0e8a16", // Green
    description: "Task is finished",
  },
  {
    name: "status:blocked",
    color: "d93f0b", // Red
    description: "Task cannot proceed",
  },
];
```

**Why these colors:** Based on [GitHub's default color palette](https://gist.github.com/borekb/d61cdc45f0c92606a92b15388cf80185) and [common label conventions](https://flavor365.com/mastering-github-labels-for-issues-pull-requests/).

### Anti-Patterns to Avoid

- **Don't create iterations via API:** The `updateProjectV2Field` mutation replaces ALL iterations, causing issues to lose their iteration assignments. Manual UI creation only.
- **Don't manually move project cards:** Use label changes + GitHub's built-in automations instead
- **Don't use POST to add labels with empty array:** This removes ALL labels (use PUT for replacement, POST for addition)
- **Don't forget URL encoding:** Label names with special characters (colons, spaces) work fine in REST API body parameters, but URL path parameters need encoding

**Source:** [GitHub Community Discussion on Iteration Creation](https://github.com/orgs/community/discussions/157957)

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem                   | Don't Build                            | Use Instead                                     | Why                                                                            |
| ------------------------- | -------------------------------------- | ----------------------------------------------- | ------------------------------------------------------------------------------ |
| Card movement automation  | Custom GraphQL mutations to move cards | GitHub's built-in workflows (status-based)      | Built-in automations react to label changes automatically, no API calls needed |
| Rate limiting             | Custom retry logic                     | @octokit/plugin-throttling (already configured) | Handles primary & secondary rate limits, automatic retries                     |
| Label color schemes       | Random hex codes                       | GitHub's default palette + semantic colors      | Accessibility tested, familiar to users, semantic meaning                      |
| Project permissions check | Try/catch on every call                | Document required permissions upfront           | GraphQL errors are opaque; better to validate setup than debug failures        |

**Key insight:** GitHub Projects v2 is designed for UI-driven configuration with API-driven item management. The API is intentionally limited for structural changes (fields, iterations) to prevent accidental data loss.

## Common Pitfalls

### Pitfall 1: Missing GITHUB_TOKEN Permissions

**What goes wrong:** GraphQL queries fail with opaque authentication errors despite token being present.

**Why it happens:** GITHUB_TOKEN default permissions are read-only as of 2023. Projects require explicit `project: write` scope.

**How to avoid:** Document required workflow permissions in action.yml and user guide:

```yaml
permissions:
  contents: write
  issues: write
  pull-requests: write
  project: write # Required for Projects v2 API
```

**Warning signs:**

- GraphQL errors mentioning "resource not accessible"
- 403/404 responses on project queries
- Works with PAT but not GITHUB_TOKEN

**Sources:**

- [GITHUB_TOKEN Permissions Documentation](https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/controlling-permissions-for-github_token)
- [GitHub Changelog: Read-only default](https://github.blog/changelog/2023-02-02-github-actions-updating-the-default-github_token-permissions-to-read-only/)

### Pitfall 2: Attempting Programmatic Iteration Creation

**What goes wrong:** Using `updateProjectV2Field` mutation to add iterations causes all existing issue-iteration assignments to be lost.

**Why it happens:** The mutation is a complete replacement operation, not an append operation. No mutation exists to add individual iterations.

**How to avoid:**

- Document manual iteration setup in user guide
- Provide GraphQL query to verify iteration exists
- Fail gracefully with clear error message if expected iteration not found
- Link to GitHub documentation for manual creation

**Warning signs:**

- Issues suddenly have no iteration assigned after API call
- Iteration field shows iterations but items are unassigned

**Sources:**

- [GitHub Community Discussion #157957](https://github.com/orgs/community/discussions/157957)
- [ProjectV2 GraphQL API Limitations](https://github.com/orgs/community/discussions/76762)

### Pitfall 3: Organization vs User Projects Query Differences

**What goes wrong:** GraphQL query works for org projects but fails for user-owned projects with unhelpful error.

**Why it happens:** Different query root (`organization(login: ...)` vs `user(login: ...)`), and fine-grained PATs cannot access user-owned projects.

**How to avoid:**

- Detect project URL pattern (`github.com/orgs/NAME` vs `github.com/users/NAME`)
- Use correct query root based on owner type
- Document limitation: action only supports organization projects (or require classic PAT for user projects)

**Warning signs:**

- "Could not resolve to a ProjectV2" error
- Works for org repos, fails for personal repos
- Permission errors despite correct scopes

**Sources:**

- [GitHub Projects CLI Examples](https://gist.github.com/ruvnet/ac1ec98a770d57571afe077b21676a1d)
- [Using API to Manage Projects](https://docs.github.com/en/issues/planning-and-tracking-with-projects/automating-your-project/using-the-api-to-manage-projects)

### Pitfall 4: GraphQL N+1 Queries

**What goes wrong:** Fetching iteration field for multiple projects causes excessive API calls and rate limiting.

**Why it happens:** Each project requires separate GraphQL query; no batch query support for multiple projects.

**How to avoid:**

- Cache project/iteration metadata in workflow state
- Query once per workflow run, not per issue
- Use pagination parameters (`first: 20`) to limit field queries

**Warning signs:**

- Rate limit warnings in logs
- Slow performance with many issues
- Multiple identical GraphQL queries in logs

**Sources:**

- [GraphQL Best Practices: N+1 Problem](https://some-natalie.dev/blog/graphql-intro/)
- [3 GraphQL Pitfalls](https://www.vanta.com/resources/3-graphql-pitfalls-and-steps-to-avoid-them)

### Pitfall 5: Label Name Encoding in URLs

**What goes wrong:** Removing labels with special characters (e.g., `status:pending`) fails with 404.

**Why it happens:** URL path parameters need encoding, but POST body parameters don't.

**How to avoid:**

- Always use `issue_number` parameter endpoints (body-based)
- Don't construct URL paths manually
- Octokit handles encoding automatically for body parameters

**Warning signs:**

- 404 errors when removing specific labels
- Works for simple names, fails for labels with colons/spaces

**Sources:**

- [Octokit Issue #560: Label Encoding](https://github.com/octokit/octokit.rb/issues/560)
- [GitHub REST API Labels](https://docs.github.com/en/rest/issues/labels)

## Code Examples

Verified patterns from official sources:

### Creating Repository Labels (REST API)

```javascript
// Source: https://docs.github.com/en/rest/issues/labels
async function createStatusLabels(owner, repo) {
  const statusLabels = [
    { name: "status:pending", color: "d4c5f9", description: "Not started" },
    { name: "status:in-progress", color: "fbca04", description: "In progress" },
    { name: "status:complete", color: "0e8a16", description: "Completed" },
  ];

  for (const label of statusLabels) {
    try {
      await octokit.rest.issues.createLabel({
        owner,
        repo,
        name: label.name,
        color: label.color,
        description: label.description,
      });
      console.log(`Created label: ${label.name}`);
    } catch (error) {
      if (error.status === 422) {
        console.log(`Label already exists: ${label.name}`);
      } else {
        throw error;
      }
    }
  }
}
```

### Adding Labels to Issues (REST API)

```javascript
// Source: https://docs.github.com/en/rest/issues/labels
async function setIssueStatus(owner, repo, issueNumber, status) {
  // Remove old status labels, add new one
  const allLabels = await octokit.rest.issues.listLabelsOnIssue({
    owner,
    repo,
    issue_number: issueNumber,
  });

  const nonStatusLabels = allLabels.data
    .filter((l) => !l.name.startsWith("status:"))
    .map((l) => l.name);

  // Replace all labels (remove old status, keep others)
  await octokit.rest.issues.setLabels({
    owner,
    repo,
    issue_number: issueNumber,
    labels: [...nonStatusLabels, `status:${status}`],
  });
}
```

### Querying Organization Project (GraphQL)

```javascript
// Source: https://docs.github.com/en/issues/planning-and-tracking-with-projects/automating-your-project/using-the-api-to-manage-projects
async function findOrgProject(orgName, projectNumber) {
  const query = `
    query($org: String!, $number: Int!) {
      organization(login: $org) {
        projectV2(number: $number) {
          id
          title
          fields(first: 20) {
            nodes {
              ... on ProjectV2IterationField {
                id
                name
                configuration {
                  iterations {
                    startDate
                    id
                    title
                  }
                }
              }
            }
          }
        }
      }
    }
  `;

  const result = await octokit.graphql(query, {
    org: orgName,
    number: projectNumber,
  });

  return result.organization.projectV2;
}
```

### Using GraphQL with @actions/github

```javascript
// Source: https://github.com/octokit/action.js
import { getOctokit } from "@actions/github";
import * as core from "@actions/core";

const token = core.getInput("token");
const octokit = getOctokit(token);

// GraphQL is available directly on octokit instance
const result = await octokit.graphql(
  `query($owner: String!, $repo: String!) {
    repository(owner: $owner, name: $repo) {
      issues(first: 5) {
        nodes {
          number
          title
        }
      }
    }
  }`,
  {
    owner: "octokit",
    repo: "graphql.js",
  },
);
```

## State of the Art

| Old Approach                    | Current Approach                  | When Changed              | Impact                                                  |
| ------------------------------- | --------------------------------- | ------------------------- | ------------------------------------------------------- |
| Projects (Classic) REST API     | Projects v2 GraphQL API           | 2022                      | Complete API redesign; no migration path for automation |
| Default read/write GITHUB_TOKEN | Default read-only GITHUB_TOKEN    | Feb 2023                  | Must explicitly grant `project: write` permission       |
| Manual card movement            | Built-in workflow automations     | 2022 (Projects v2 launch) | Label-triggered automations eliminate manual API calls  |
| Iteration management API        | Manual UI-only iteration creation | Current limitation        | No safe way to create iterations programmatically       |

**Deprecated/outdated:**

- **Projects (Classic) API:** Still works but no longer developed; Projects v2 is the future
- **`github.issues.*` in actions:** v5+ requires `github.rest.issues.*` namespace
- **Automatic project write access:** Now requires explicit permission grant

**Sources:**

- [GitHub Changelog: ProjectsV2 Launch](https://github.blog/changelog/2022-06-23-the-new-github-issues-june-23rd-update/)
- [GitHub Changelog: Default Read-only Token](https://github.blog/changelog/2023-02-02-github-actions-updating-the-default-github_token-permissions-to-read-only/)

## Open Questions

Things that couldn't be fully resolved:

1. **Can iterations be created via undocumented API?**
   - What we know: Some users mention "private API exists" based on browser network inspection
   - What's unclear: No official documentation or stable endpoint
   - Recommendation: Do not rely on undocumented APIs; document manual setup process

2. **Do built-in automations work with custom status values?**
   - What we know: Built-in automations work with standard "Status" field and values (Todo, In Progress, Done)
   - What's unclear: Whether custom single-select fields can trigger automations
   - Recommendation: Use standard Status field, map to our label taxonomy in documentation

3. **What's the rate limit for GraphQL Projects queries?**
   - What we know: GraphQL has point-based rate limiting (5000 points/hour), but project queries cost is undocumented
   - What's unclear: How many project queries can run per workflow
   - Recommendation: Cache project metadata, query once per workflow run

4. **Can user-owned projects work with GITHUB_TOKEN?**
   - What we know: Fine-grained PATs cannot access user projects (documented gap)
   - What's unclear: Whether GITHUB_TOKEN (different token type) has same limitation
   - Recommendation: Document as org-projects-only feature, or require classic PAT for user projects

## Sources

### Primary (HIGH confidence)

- [GitHub REST API Labels](https://docs.github.com/en/rest/issues/labels) - Label CRUD operations
- [GitHub Projects v2 API Guide](https://docs.github.com/en/issues/planning-and-tracking-with-projects/automating-your-project/using-the-api-to-manage-projects) - GraphQL patterns
- [GitHub Built-in Automations](https://docs.github.com/en/issues/planning-and-tracking-with-projects/automating-your-project/using-the-built-in-automations) - Workflow configuration
- [Iteration Fields Documentation](https://docs.github.com/en/issues/planning-and-tracking-with-projects/understanding-fields/about-iteration-fields) - Manual setup process
- [GITHUB_TOKEN Permissions](https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/controlling-permissions-for-github_token) - Required scopes

### Secondary (MEDIUM confidence)

- [GitHub Community Discussion #157957](https://github.com/orgs/community/discussions/157957) - Iteration creation limitation (verified by multiple users, no official response)
- [@actions/github Examples](https://snyk.io/advisor/npm-package/@actions/github/example) - Code patterns verified against official docs
- [Octokit Action.js README](https://github.com/octokit/action.js/) - GraphQL usage patterns
- [Default Label Colors](https://gist.github.com/borekb/d61cdc45f0c92606a92b15388cf80185) - Community-verified GitHub palette

### Tertiary (LOW confidence)

- [Label Taxonomy Guide](https://flavor365.com/mastering-github-labels-for-issues-pull-requests/) - Best practices (single source, 2025)
- [GraphQL Pitfalls Article](https://www.vanta.com/resources/3-graphql-pitfalls-and-steps-to-avoid-them) - General GraphQL advice, not GitHub-specific

## Metadata

**Confidence breakdown:**

- Standard stack: HIGH - @actions/github v7 already installed, REST API stable and well-documented
- Architecture: HIGH - REST for labels, GraphQL for projects, manual iteration setup
- Pitfalls: HIGH - All critical pitfalls verified via official docs or reproducible community issues
- Iteration creation: MEDIUM - Limitation confirmed by community, workarounds documented, but no official response

**Research date:** 2026-01-22
**Valid until:** 2026-02-22 (30 days - stable APIs, but GraphQL schema may add iteration creation mutation)

**Critical gap to monitor:** GitHub may add `addProjectV2Iteration` or similar mutation to address community requests. Check [GraphQL Changelog](https://docs.github.com/en/graphql/overview/changelog) monthly.
