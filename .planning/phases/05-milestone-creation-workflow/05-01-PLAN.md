---
phase: 05-milestone-creation-workflow
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/milestone/planning-docs.js
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Planning documents (PROJECT.md, STATE.md, ROADMAP.md) are created with milestone context"
    - "Files are created in `.github/planning/milestones/{n}/` directory structure"
  artifacts:
    - path: "src/milestone/planning-docs.js"
      provides: "Document generation functions"
      exports: ["createPlanningDocs", "generateProjectMarkdown", "generateStateMarkdown", "generateRoadmapMarkdown"]
    - path: ".github/planning/milestones/{n}/PROJECT.md"
      provides: "Milestone context and goals"
      contains: "Milestone {n}"
    - path: ".github/planning/milestones/{n}/STATE.md"
      provides: "Milestone number and status"
      contains: "Milestone {n} State"
    - path: ".github/planning/milestones/{n}/ROADMAP.md"
      provides: "Phase structure"
      contains: "Milestone {n} Roadmap"
  key_links:
    - from: "src/milestone/planning-docs.js"
      to: "src/index.js"
      via: "import statement"
      pattern: "import.*planning-docs"
---

<objective>
Create the planning documents module that generates PROJECT.md, STATE.md, and ROADMAP.md files for milestone creation.

Purpose: Establish the document generation foundation that all subsequent milestone workflow plans depend on.
Output: src/milestone/planning-docs.js with createPlanningDocs and individual markdown generators
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/dejan/00-code/00-ai-agents-skills-plugins/agent/.planning/phases/05-milestone-creation-workflow/05-RESEARCH.md
@/Users/dejan/00-code/00-ai-agents-skills-plugins/agent/src/index.js
</context>

<tasks>

<task type="auto">
  <name>Create src/milestone/planning-docs.js module</name>
  <files>src/milestone/planning-docs.js</files>
  <action>
Create the planning documents module with the following structure:

1. Import required modules:
   - fs from "node:fs/promises"
   - * as core from "@actions/core"

2. Export these functions:
   - `createPlanningDocs(milestoneData)` - Creates all 3 docs, returns files map
   - `generateProjectMarkdown(data)` - Generates PROJECT.md content
   - `generateStateMarkdown(data)` - Generates STATE.md content
   - `generateRoadmapMarkdown(data)` - Generates ROADMAP.md content

3. For `createPlanningDocs`:
   - Accept milestoneData: { owner, repo, milestoneNumber, title, goal, scope, features, requirements, phases }
   - Create directory structure: `.github/planning/milestones/{n}/` and `/phases`
   - Use fs.mkdir with { recursive: true }
   - Write all 3 files using fs.writeFile
   - Return files map: { project: {path, purpose}, state: {path, purpose}, roadmap: {path, purpose} }

4. Document templates should include:
   - PROJECT.md: milestone context, goal, scope, features, requirements summary
   - STATE.md: milestone number, status, phase status table, requirements gathering status, workflow metadata
   - ROADMAP.md: phase structure with placeholder phases

Reference the research document for exact template formats (Pattern 4 in 05-RESEARCH.md).
  </action>
  <verify>
node --input-type=module -e "
import { createPlanningDocs, generateProjectMarkdown, generateStateMarkdown, generateRoadmapMarkdown } from './src/milestone/planning-docs.js';

console.log('All exports available:', {
  createPlanningDocs: typeof createPlanningDocs === 'function',
  generateProjectMarkdown: typeof generateProjectMarkdown === 'function',
  generateStateMarkdown: typeof generateStateMarkdown === 'function',
  generateRoadmapMarkdown: typeof generateRoadmapMarkdown === 'function'
});

// Test generate functions
const testData = {
  milestoneNumber: 1,
  title: 'Test Milestone',
  goal: 'Test goal',
  scope: 'Test scope',
  features: ['Feature 1', 'Feature 2'],
  requirements: { answered: { scope: 'Test goal' }, pending: ['features'] },
  phases: [{ name: 'Foundation', goal: 'Set up foundation' }],
  status: 'planning',
  createdAt: new Date().toISOString(),
  lastRunAt: null,
  runCount: 1
};

const projectMd = generateProjectMarkdown(testData);
const stateMd = generateStateMarkdown(testData);
const roadmapMd = generateRoadmapMarkdown(testData);

console.log('PROJECT.md generated:', projectMd.includes('Test Milestone'));
console.log('STATE.md generated:', stateMd.includes('Milestone 1 State'));
console.log('ROADMAP.md generated:', roadmapMd.includes('Milestone 1 Roadmap'));
"
</verify>
  <done>
src/milestone/planning-docs.js exists with all 4 export functions working correctly, and test output confirms all markdown generators produce valid output with milestone context
</done>
</task>

<task type="auto">
  <name>Verify file creation via createPlanningDocs</name>
  <files>src/milestone/planning-docs.js</files>
  <action>
Test the createPlanningDocs function to ensure it creates files correctly:

1. Create test milestone data with realistic values
2. Call createPlanningDocs and verify it:
   - Creates the directory structure
   - Writes PROJECT.md, STATE.md, ROADMAP.md files
   - Returns correct files map
3. Clean up test files after verification
4. Add module to index.js imports (trigger bundling)

The createPlanningDocs function should create files in `.github/planning/milestones/{n}/` directory.
  </action>
  <verify>
node --input-type=module -e "
import { createPlanningDocs } from './src/milestone/planning-docs.js';
import fs from 'node:fs/promises';
import path from 'node:path';

const testData = {
  owner: 'test-user',
  repo: 'test-repo',
  milestoneNumber: 99,
  title: 'Integration Test',
  goal: 'Test goal for verification',
  scope: 'Test scope',
  features: ['Test feature 1', 'Test feature 2'],
  requirements: { answered: {}, pending: [], complete: false },
  phases: [{ name: 'Test Phase', goal: 'Test phase goal' }],
  status: 'planning',
  createdAt: new Date().toISOString(),
  lastRunAt: null,
  runCount: 1
};

const files = await createPlanningDocs(testData);

console.log('Files created:', Object.keys(files));
console.log('PROJECT.md path:', files.project?.path);
console.log('STATE.md path:', files.state?.path);
console.log('ROADMAP.md path:', files.roadmap?.path);

// Verify files exist
for (const [key, file] of Object.entries(files)) {
  try {
    const content = await fs.readFile(file.path, 'utf-8');
    console.log(key + ' exists and has content:', content.length > 0);
  } catch (e) {
    console.log(key + ' ERROR:', e.message);
  }
}

// Cleanup
for (const file of Object.values(files)) {
  await fs.rm(path.dirname(file.path), { recursive: true, force: true });
}
console.log('Test files cleaned up');
"
</verify>
  <done>
createPlanningDocs creates all 3 files in the correct directory structure with valid content, and cleanup removes test artifacts
</done>
</task>

</tasks>

<verification>
1. Module imports without errors in Node.js
2. All 4 export functions are available and callable
3. generateProjectMarkdown produces PROJECT.md with milestone context
4. generateStateMarkdown produces STATE.md with milestone status
5. generateRoadmapMarkdown produces ROADMAP.md with phase structure
6. createPlanningDocs creates files in `.github/planning/milestones/{n}/`
</verification>

<success_criteria>
- src/milestone/planning-docs.js exports all required functions
- Files are created in correct directory structure
- All document templates include milestone context
- Module is importable and works without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-milestone-creation-workflow/05-01-SUMMARY.md`
</output>
